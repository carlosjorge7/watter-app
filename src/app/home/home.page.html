<ion-menu type="push" side="end" contentId="main-content">
  <ion-header>
    <ion-toolbar color="primary">
      <ion-title>
        <ion-icon name="water"></ion-icon>
        <span>AquaMad Menu</span>
      </ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-content class="ion-padding">
    <ion-list>
      <ion-item button (click)="openStatistics()">
        <ion-icon name="analytics" slot="start"></ion-icon>
        <ion-label>Estadísticas</ion-label>
      </ion-item>

      <ion-item button (click)="openSettings()">
        <ion-icon name="settings" slot="start"></ion-icon>
        <ion-label>Configuración</ion-label>
      </ion-item>

      <ion-item button (click)="openAbout()">
        <ion-icon name="information-circle" slot="start"></ion-icon>
        <ion-label>Acerca de</ion-label>
      </ion-item>

      <ion-item button (click)="reportIssue()">
        <ion-icon name="bug" slot="start"></ion-icon>
        <ion-label>Reportar problema</ion-label>
      </ion-item>

      <ion-item button (click)="shareApp()">
        <ion-icon name="share" slot="start"></ion-icon>
        <ion-label>Compartir app</ion-label>
      </ion-item>

      <ion-item button (click)="openDataSource()">
        <ion-icon name="library" slot="start"></ion-icon>
        <ion-label>Fuente de datos oficial (Ayuntamiento de Madrid)</ion-label>
      </ion-item>
    </ion-list>
  </ion-content>
</ion-menu>

<div class="ion-page" id="main-content">
  <ion-header [translucent]="true">
    <ion-toolbar color="primary">
      <ion-title>
        <ion-icon name="water"></ion-icon>
        <span>AquaMad</span>
      </ion-title>
      <ion-buttons slot="end">
        <ion-menu-button></ion-menu-button>
      </ion-buttons>
    </ion-toolbar>

    @if (showProgressBar) {
    <ion-progress-bar [value]="loadingProgress / 100" type="determinate">
    </ion-progress-bar>

    <div class="loading-info">
      <span
        >Cargando fuentes... {{ watterLocations.length }} / {{
        totalExpectedFountains }} ({{ loadingProgress.toFixed(0) }}%)</span
      >
    </div>
    }
  </ion-header>

  <ion-content [fullscreen]="true">
    <div class="container">
      <capacitor-google-map #map></capacitor-google-map>

      @if (!loading && watterLocations.length > 0) {
      <!-- FAB principal que abre el menú de acciones -->
      <ion-fab vertical="bottom" horizontal="end" slot="fixed">
        <ion-fab-button color="primary" (click)="openActionsMenu()">
          <ion-icon name="apps"></ion-icon>
        </ion-fab-button>
        <ion-label class="fab-label">Acciones</ion-label>
      </ion-fab>

      <!-- Indicador de favoritos como badge flotante -->
      @if (favoritesCount$ | async; as count) { @if (count > 0) {
      <div class="favorites-indicator">
        <ion-badge color="danger">{{ count }}</ion-badge>
        <span>Favoritos</span>
      </div>
      } } }
    </div>
  </ion-content>
</div>
